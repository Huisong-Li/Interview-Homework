# -*- coding=gb2312 -*-
import pandas as pd
import xlrd
import MySQLdb


def interception(xlsfile,sheet,index_col,header_target,skip_footer_target):

	data = xlrd.open_workbook(xlsfile)
	table = data.sheet_by_name(sheet)
	col_values_list = table.col_values(index_col)
	header_parameter  = 1
	skip_footer_parameter = 1   
	for col_values in col_values_list:

		if col_values== unicode(header_target,'gb2312'):
			# print(header_parameter)
			break
		header_parameter = header_parameter + 1
      
	for col_values in col_values_list:

		if col_values== unicode(skip_footer_target,'gb2312'):
			# print(skip_footer_parameter)
			break
		skip_footer_parameter = skip_footer_parameter + 1

	df = pd.read_excel(xlsfile, sheetname=sheet, header = header_parameter-1 ,skip_footer = len(col_values_list)-skip_footer_parameter+1)
	
	'''
	print(df.describe)
	print("The list of row indicies")
	print(df.index)
	print("The column headings")
	print(df.columns)
	'''
	
	return df
	
def readRow(df):
	i = 0
	while i < len(df.index):
		a = df.iloc[i][u'数量']	
		print(a)
		i = i + 1

def getElement(col,row_series):
	element = row_series[col]
	return element

def insertData(df):

    conn = MySQLdb.connect('localhost', 'root', '564753', 'Homework') 
    cursor = conn.cursor()
    i = 0   
    while i < len(df.index):
		row_series = df.iloc[i]
		# print(row_series)
		i = i + 1
		
		L_CURRENT_AMOUNT = getElement(u'数量',row_series)
		if pd.isnull(L_CURRENT_AMOUNT):
		    cursor.execute('''insert into portHolding (L_CURRENT_AMOUNT)VALUES(null)''')
		else:
			cursor.execute('''insert into portHolding (L_CURRENT_AMOUNT)VALUES(%s)''',L_CURRENT_AMOUNT)
		
		unit_Cost = getElement(u'单位成本',row_series)
		if pd.isnull(unit_Cost):
		    cursor.execute('''insert into portHolding (unit_Cost)VALUES(null)''')
		else:
			cursor.execute('''insert into portHolding (unit_Cost)VALUES(%s)''',unit_Cost)
			
		cost = getElement(u'成本',row_series)
		if pd.isnull(cost):
		    cursor.execute('''insert into portHolding (cost)VALUES(null)''')
		else:
			cursor.execute('''insert into portHolding (cost)VALUES(%s)''',cost)
		
		market_Price = getElement(u'市价',row_series)
		if pd.isnull(market_Price):
		    cursor.execute('''insert into portHolding (market_Price)VALUES(null)''')
		else:
			cursor.execute('''insert into portHolding (market_Price)VALUES(%s)''',market_Price)
		
		market_Value = getElement(u'市值',row_series)
		if pd.isnull(market_Value):
		    cursor.execute('''insert into portHolding (market_Value)VALUES(null)''')
		else:
			cursor.execute('''insert into portHolding (market_Value)VALUES(%s)''',market_Value)
		
		PandL = getElement(u'估值增值',row_series)
		if pd.isnull(PandL):
		    cursor.execute('''insert into portHolding (PandL)VALUES(null)''')
		else:
			cursor.execute('''insert into portHolding (PandL)VALUES(%s)''',PandL)
		
		#print(type(L_CURRENT_AMOUNT))
    conn.commit()    
    cursor.close()

def createMySQL():
    
    conn = MySQLdb.connect(host='localhost', user='root',passwd='564753')  
    cursor = conn.cursor()  
    cursor.execute("""create database if not exists Homework """)  
    conn.select_db('homework')
    sql = '''create table IF NOT EXISTS portHolding(
			 port_ID varchar(20),
			 L_DATE varchar(8),
			 fund_ID varchar(20),
			 POSITION_FLAG varchar(10),
			 MARKET_NO varchar(5),
			 VC_INTER_CODE varchar(10),
			 security_code varchar(20),
			 security_Type varchar(10),
			 L_CURRENT_AMOUNT float,
			 unit_Cost float,
			 cost float,
			 market_Price float,
			 market_Value float,
			 PandL float,
			 BEGIN_AMOUNT float,
			 BUY_AMOUNT float,
			 sale_amount float,
			 buy_Cash float,
			 sale_Cash float,
			 BUY_FEE float,
			 SALE_FEE float,
             TODAY_PROFIT float)''' 
    cursor.execute(sql)  	
    cursor.close()
	
if __name__ == "__main__":
	#createMySQL()
	block = interception('富善优享7号_外贸信托-富善优享7号集合资金信托计划_2015-05-21.xls','Sheet1',1,'科目代码','')
	# readrow(block)
	insertData(block)
	# interception('证券投资基金估值表_双隆1号_2014-12-19.xls','Sheet1',0,'科目代码','')